---
import BaseLayout from '../layouts/BaseLayout.astro';
import Sidebar from '../components/Sidebar.jsx';
import Section from '../components/Section.astro';
import ContentEntry from '../components/ContentEntry.astro';
import { getLatestWritings, getProjects } from '../lib/queries';

// --- Fetch live data using the new functions ---
const latestWritings = await getLatestWritings();
const projects = await getProjects();


// Static data remains
const name = "Krish Patel";
const subtitle = "SWE @ Airtech International | UCI '25";
const bio = "I'm a software engineer focused on building end-to-end systems that serve unique purposes, from the simplest to the most complex. My skills range from machine learning & embedded systems to fullstack development & DevOps, but I'm always looking to coninue growing my knowledge pool amd skill set.";
---
<BaseLayout title="Krish Patel - Software Engineer">
  <Sidebar client:load />
  <main class="space-y-12">
    <!-- Header Section -->
    <Section>
        <div slot="title">
          <h1 class="text-xl font-bold text-neutral-900 dark:text-white">{name}</h1>
          <p class="text-neutral-500 dark:text-neutral-400">{subtitle}</p>
        </div>
      <p class="text-base text-neutral-600 dark:text-neutral-300">{bio}</p>
    </Section>

    <hr class="border-neutral-200 dark:border-neutral-800" />

    <!-- Latest Writings Section -->
    <Section linkUrl="/posts" linkText="Read All Posts â†’">
      <h2 slot="title" class="flex items-center gap-2 text-neutral-900 dark:text-white">Latest Writings</h2>
      {latestWritings.map(entry => (
        <ContentEntry 
          title={entry.title} 
          date={new Date(entry.publishedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} 
          description={entry.description} 
          url={`/posts/${entry.slug}`} 
        />
      ))}
    </Section>

    <hr class="border-neutral-200 dark:border-neutral-800" />

    <!-- Projects Section -->
    <Section>
      <h2 slot="title" class="text-neutral-900 dark:text-white">Projects</h2>
      {projects.map(entry => (
        <ContentEntry 
          title={entry.title} 
          date={entry.date} 
          description={entry.description} 
          url={entry.url || (entry.slug ? `/projects/${entry.slug}` : undefined)} 
        />
      ))}
    </Section>
  </main>
</BaseLayout>

